app.factory('Products', function($http, $httpParamSerializer, $location){
	var protocol = $location.protocol();
	var host = "http://localhost:3000";
	var prd = {};
	var _baseUrl = host + "/api";
    var productImage = host + "/uploads/warehouse/products/"


	var makeUrl = function(params, cb){
		cb(_baseUrl + params);
	};

	var sendRequest = function(method, cb){
		makeUrl(method, function(url){
			$http.get(url).success(function(r){
				return cb(null, r);
			}).error(function(e){
				return cb(e, null);
			});
		});
	};
/*
	GET ALL PRODUCT WITHOUT WHERE
*/
	prd.getAll = function(opt, cb){
		var url = '/ProductSharings/getProducts/'+opt.userId+'?cursor='+opt.cursor+'&item='+opt.item;

			sendRequest(url, function(e, r){
				if(r){
                    console.log(r);
                    r.baseImage = productImage;
					return cb(null, r);
				}else{
					return cb(e, null);
				}
			});
	};
    
    prd.count = function(opt, cb){
		var url = '/ProductSharings/getProductsCount/'+opt.userId;

			sendRequest(url, function(e, r){
				if(r){
                    console.log(r)
					return cb(null, r);
				}else{
					return cb(e, null);
				}
			});
	};
    
    prd.getOne = function(opt, cb){
        var url = '/ProductSharings/zoomProduct/'+opt.productId;
        sendRequest(url, function(e, r){
				if(r){
                    r.baseImage = productImage;
                    console.log(r)
					return cb(null, r);
				}else{
					return cb(e, null);
				}
        });
    };
    
    prd.getCat = function(opt, cb){
        var url = '/ProductSharings/findCategories';
        sendRequest(url, function(e, r){
				if(r){
                    console.log(r)
					return cb(null, r);
				}else{
					return cb(e, null);
				}
        });
    };
	return prd;
});
